#include <dlfcn.h>
#include <stdlib.h>
#include <stdio.h>
#include <string.h>

typedef void (*simple_demo_function)(char*, int, unsigned int&);

int main(void) {
	const char *error;
	void *module;
	simple_demo_function demo_function;

	/* Load dynamically loaded library */
	module = dlopen("TestDLL.so", RTLD_LAZY);
	if (!module) {
		fprintf(stderr, "Couldn't open libhello.so: %s\n",
		dlerror());
		exit(1);
	}

	/* Get symbol */
	dlerror();
	demo_function = (simple_demo_function)dlsym(module, "setDataNegative");
	if ((error = dlerror())) {
		fprintf(stderr, "Couldn't find hello: %s\n", error);
		exit(1);
	}

	/* Now call the function in the DL library */
	char *s = (char*)calloc(5006, sizeof(char));
	strncpy(s, "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", 5006);
	unsigned int a = 27;
	(*demo_function)(s, 5005, a);

	/* All done, close things cleanly */
	dlclose(module);
	return 0;
}
